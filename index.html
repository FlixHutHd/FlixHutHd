<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlixHutHD</title>
  <link rel="icon" href="FlixHutHd0.png" type="image/png">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary-dark: #0F0F0F;
      --bg-secondary-dark: #1A1A1A;
      --bg-tertiary-dark: #242424;
      --text-primary-dark: #F0F0F0;
      --text-secondary-dark: #C0C0C0;
      --border-color-dark: #2A2A2A;
      --card-shadow-dark: rgba(0, 0, 0, 0.3);
      --modal-bg-dark: rgba(30, 30, 30, 0.85); /* Glassmorphism bg for modal */
      --modal-border-dark: rgba(50, 50, 50, 0.5);

      --bg-primary-light: #F4F6F8;
      --bg-secondary-light: #FFFFFF;
      --bg-tertiary-light: #E9ECEF;
      --text-primary-light: #212529;
      --text-secondary-light: #495057;
      --border-color-light: #DEE2E6;
      --card-shadow-light: rgba(0, 0, 0, 0.1);
      --modal-bg-light: rgba(255, 255, 255, 0.85); /* Glassmorphism bg for modal */
      --modal-border-light: rgba(200, 200, 200, 0.5);

      /* Default to dark theme variables */
      --bg-primary: var(--bg-primary-dark);
      --bg-secondary: var(--bg-secondary-dark);
      --bg-tertiary: var(--bg-tertiary-dark);
      --text-primary: var(--text-primary-dark);
      --text-secondary: var(--text-secondary-dark);
      --border-color: var(--border-color-dark);
      --card-shadow: var(--card-shadow-dark);
      --modal-bg: var(--modal-bg-dark);
      --modal-border: var(--modal-border-dark);

      --accent-primary: #00A9FF; 
      --accent-primary-darker: #007BBD;
      --accent-secondary: #FFA000; 
      --button-hover-primary: var(--accent-primary-darker);
      --download-link-color: var(--accent-primary);
      --download-section-title-color: #FF3D71; 
      --base-font-size: 16px;
      --success-color: #4CAF50;
      --error-color: #F44336;
    }

    /* Light theme overrides */
    body.light-theme {
      --bg-primary: var(--bg-primary-light);
      --bg-secondary: var(--bg-secondary-light);
      --bg-tertiary: var(--bg-tertiary-light);
      --text-primary: var(--text-primary-light);
      --text-secondary: var(--text-secondary-light);
      --border-color: var(--border-color-light);
      --card-shadow: var(--card-shadow-light);
      --modal-bg: var(--modal-bg-light);
      --modal-border: var(--modal-border-light);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.7; 
      overflow-x: hidden;
      font-size: var(--base-font-size);
      transition: background-color 0.4s ease, color 0.4s ease; 
    }
    body.modal-open, body.category-menu-open {
        overflow: hidden;
    }

    ::-webkit-scrollbar { width: 10px; } 
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--accent-primary); border-radius: 5px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--button-hover-primary); }

    a { text-decoration: none; color: var(--accent-primary); transition: color 0.25s ease, transform 0.2s ease; }
    a:hover { color: var(--accent-secondary); text-decoration: none !IMPORTANT; }

    .container { width: 96%; max-width: 1440px; margin: 0 auto; padding: 0 20px; }

    header.primary-header { 
      background: linear-gradient(to bottom, var(--bg-secondary), var(--bg-primary) 150%);
      border-bottom: 1px solid var(--border-color); 
      box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
      position: sticky;
      top: 0;
      z-index: 1002; 
      padding: 5px 0; /* Reduced padding a bit */
    }
    .primary-header .navbar-default .container {
        display: flex;
        justify-content: space-between; /* Space between logo and theme toggle */
        align-items: center;
    }
    .primary-header .navbar-header { padding: 3px 0; }
    .primary-header .navbar-brand img.site-logo {
        height: 50px; 
        width: auto;
        vertical-align: middle;
        transition: transform 0.3s ease;
    }
    .primary-header .navbar-brand img.site-logo:hover { transform: scale(1.05); }
    .site-title-text {
        font-size: 2.1em; 
        font-weight: 700;
        color: var(--accent-primary);
        font-family: 'Rajdhani', sans-serif;
        text-shadow: 1px 1px 3px rgba(0,0,0,0.1); 
    }
    
    /* Theme Toggle Button */
    .theme-toggle-button {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        color: var(--text-secondary);
        padding: 8px 10px;
        border-radius: 20px; /* Pill shape */
        cursor: pointer;
        font-size: 1.1em; /* Icon size */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .theme-toggle-button:hover {
        background: var(--accent-primary);
        color: #fff;
        box-shadow: 0 2px 5px rgba(0,169,255,0.3);
    }
    .theme-toggle-button .fa-sun { display: none; } /* Hidden by default */
    body.light-theme .theme-toggle-button .fa-sun { display: inline-block; }
    body.light-theme .theme-toggle-button .fa-moon { display: none; }


    .carousel-slider-container {
        width: 100%;
        height: 200px; 
        overflow: hidden;
        position: relative;
        background-color: var(--bg-primary);
        padding: 12px 0; 
        border-top: 1px solid var(--border-color);
        border-bottom: 1px solid var(--border-color);
    }
    .carousel-slider-wrapper { display: flex; height: 100%; }
    .carousel-slide-item {
        width: 160px; 
        height: 170px; 
        min-width: 160px;
        flex-shrink: 0;
        margin: 0 10px; 
        position: relative;
        border-radius: 6px; 
        overflow: hidden;
        box-shadow: 0 3px 8px var(--card-shadow); 
        border: 1px solid transparent; 
        cursor: pointer;
        transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, border-color 0.3s ease-out;
    }
    .carousel-slide-item:hover {
        transform: translateY(-4px) scale(1.03); 
        box-shadow: 0 6px 15px var(--card-shadow); /* Use theme variable */
        border-color: var(--accent-primary);
    }
    .carousel-slide-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
    
    nav.category-navbar { 
      background-color: var(--bg-primary); 
      padding: 10px 0 !important; 
      border-top: 1px solid var(--border-color); 
      border-bottom: 1px solid var(--border-color); 
      position: relative;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
    }
    nav.category-navbar .container { display: flex; justify-content: space-between; align-items: center; }
    nav.category-navbar .left-group { display: flex; align-items: center; flex-grow: 1; overflow: hidden; }
    button.category-toggle { display: none; background: transparent; border: none; color: var(--accent-primary); font-size: 1.6em; cursor: pointer; padding: 6px 10px; margin-right: 10px; border-radius: 4px; transition: background-color 0.2s ease, color 0.2s ease; }
    button.category-toggle:hover { background-color: var(--bg-tertiary); color: var(--accent-secondary); }
    
    a.custom-button-4khdhub {
        color: #fff !important; 
        background: linear-gradient(135deg, var(--accent-secondary), #e68a00); 
        padding: 7px 12px; 
        border-radius: 5px; 
        font-weight: 600;
        display: inline-flex;
        align-items: center; 
        gap: 5px; 
        font-size: 0.9em; 
        margin-right: 12px; 
        white-space: nowrap;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        transition: background-color 0.25s ease, transform 0.2s ease, box-shadow 0.2s ease;
        height: 38px; 
        line-height: normal; 
    }
    a.custom-button-4khdhub:hover { background: linear-gradient(135deg, #e68a00, var(--accent-secondary)); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    a.custom-button-4khdhub i { margin-right: 4px; }

    .inline-mobile-search-form { display: none; align-items: center; margin-left: 15px; }
    .inline-mobile-search-form input[type="search"] {
        padding: 0 14px; 
        border: 1px solid var(--border-color);
        background-color: var(--bg-tertiary);
        color: var(--text-primary);
        border-radius: 18px 0 0 18px; 
        font-size: 0.9em; 
        width: 150px; 
        height: 38px; 
        line-height: 38px; 
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    .inline-mobile-search-form button {
        padding: 0 14px; 
        height: 38px;
        background: var(--accent-primary);
        color: #fff;
        border: none;
        border-radius: 0 18px 18px 0; 
        cursor: pointer;
        font-size: 0.95em; 
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
    }
    .inline-mobile-search-form input[type="search"]:focus {
        outline: none;
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-primary) 30%, transparent);
    }
    .inline-mobile-search-form button:hover { background: var(--button-hover-primary); }

    ul.category-links { list-style: none; display: flex; align-items: center; margin: 0; padding: 0; white-space: nowrap; }
    ul.category-links li { position: relative; margin-right: 4px; } 
    ul.category-links li a { color: var(--text-secondary); padding: 7px 10px; display: block; font-size: 0.9em; border-radius: 4px; font-weight: 500; transition: background-color 0.25s ease, color 0.25s ease, transform 0.15s ease; cursor: pointer; }
    ul.category-links > li > a:hover, ul.category-links > li > a.active-category-link { background-color: var(--accent-primary); color: #fff; transform: translateY(-1px); }
    ul.category-links li.dropdown .arrow { font-size: 0.65em; margin-left: 4px; }
    ul.category-links li .dropdown-menu { display: none; position: absolute; top: 100%; left: 0; background-color: var(--bg-tertiary); box-shadow: 0 5px 12px var(--card-shadow); padding: 6px 0; list-style: none; min-width: 190px; z-index: 1001; border-radius: 0 0 5px 5px; border: 1px solid var(--border-color); border-top: none; }
    ul.category-links li.dropdown:hover .dropdown-menu { display: block; }
    ul.category-links li .dropdown-menu li a { padding: 8px 12px; font-size: 0.85em; color: var(--text-secondary); }
    ul.category-links li .dropdown-menu li a:hover, ul.category-links li .dropdown-menu li a.active-category-link { background-color: var(--accent-primary); color: #fff; }

    .search-container { display: flex; align-items: center; margin-left: auto; } 
    .search-container form { display: flex; }
    .search-container input[type="search"] { padding: 7px 12px; border: 1px solid var(--border-color); background-color: var(--bg-secondary); color: var(--text-primary); border-radius: 18px 0 0 18px; font-size: 0.85em; width: 180px; transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease; }
    .search-container input[type="search"]:focus { outline: none; border-color: var(--accent-primary); background-color: var(--bg-tertiary); box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent-primary) 30%, transparent); }
    .search-container button { padding: 7px 12px; background: var(--accent-primary); color: #fff; border: none; border-radius: 0 18px 18px 0; cursor: pointer; font-size: 0.85em; font-weight: 500; transition: background-color 0.2s ease; }
    .search-container button:hover { background: var(--button-hover-primary); }

    section.sitewide-notice { background: var(--bg-tertiary); margin: 20px auto; padding: 12px 18px; color: var(--text-secondary); font-weight: 400; border-radius: 6px; text-align: center; font-size: 0.95em; width: 96%; max-width: 1380px; position: relative; border: 1px solid var(--border-color); box-shadow: 0 2px 6px var(--card-shadow); }
    section.sitewide-notice strong a, section.sitewide-notice a { color: var(--accent-primary) !important; font-weight: 600; }
    section.sitewide-notice a:hover { color: var(--accent-secondary) !important; text-decoration: underline !important; }
    span.closebtn { color: var(--text-secondary); font-size: 22px; line-height: 1; position: absolute; top: 50%; right: 12px; transform: translateY(-50%); cursor: pointer; padding: 3px 6px; transition: color 0.2s ease; }
    span.closebtn:hover { color: var(--text-primary); }

    section.home-wrapper { padding: 20px 0; }
    h2.section-category-name { 
      color: var(--text-primary); 
      margin-bottom: 20px; 
      margin-top: 15px; 
      font-size: 1.6em; 
      font-family: 'Rajdhani', sans-serif; 
      padding-bottom: 10px; 
      display: flex; 
      align-items: center; 
      font-weight: 700; 
      border-bottom: 3px solid var(--accent-primary); 
      text-transform: uppercase; 
      letter-spacing: 1px; 
    }
    h2.section-category-name i { margin-right: 12px; color: var(--accent-primary); font-size: 1.2em; }

    ul.recent-movies-grid { list-style: none; display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 1.2rem; padding: 0; } 
    li.movie-card-item { 
      background: var(--bg-secondary); /* Changed from tertiary for better contrast with page bg */
      border-radius: 8px; 
      overflow: hidden; 
      box-shadow: 0 4px 10px var(--card-shadow); 
      transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, border-color 0.3s ease; 
      display: flex; 
      flex-direction: column; 
      border: 1px solid var(--border-color); 
      cursor: pointer; 
    }
    li.movie-card-item:hover { 
      transform: translateY(-6px) scale(1.02); 
      box-shadow: 0 8px 18px var(--card-shadow); 
      border-color: var(--accent-primary); 
    }
    li.movie-card-item figure { margin: 0; position: relative; overflow: hidden; } 
    li.movie-card-item figure img { 
      width: 100%; 
      height: 260px; 
      object-fit: cover; 
      display: block;
      transition: transform 0.35s ease-out; 
    }
    li.movie-card-item:hover figure img {
      transform: scale(1.08); 
    }
    li.movie-card-item figcaption { 
      padding: 14px 12px; 
      background: var(--bg-tertiary); 
      flex-grow: 1; 
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      min-height: 75px; 
      border-top: 1px solid var(--border-color); 
    }
    li.movie-card-item figcaption p.movie-title-link {
        color: var(--text-primary);
        font-size: 0.95em; 
        font-weight: 600;
        line-height: 1.45;
        text-align: center;
    }

    .pagination-wrapper { text-align: center; margin: 35px 0 25px; }
    .pagination-wrapper ul.pagination { list-style: none; display: inline-flex; padding: 0; margin: 0; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 5px var(--card-shadow); }
    .pagination-wrapper ul.pagination li button,
    .pagination-wrapper ul.pagination li span {
      color: var(--text-primary); background-color: var(--bg-tertiary);
      padding: 9px 15px; display: block;
      border: none;
      border-right: 1px solid var(--bg-secondary); 
      font-size: 0.95em; font-weight: 500;
      cursor: pointer;
      transition: background-color 0.25s ease, color 0.2s ease;
    }
    .pagination-wrapper ul.pagination li:last-child button,
    .pagination-wrapper ul.pagination li:last-child span { border-right: none; }
    .pagination-wrapper ul.pagination li button:hover:not(:disabled) { background-color: var(--accent-primary); color: #fff; }
    .pagination-wrapper ul.pagination li button.current-page,
    .pagination-wrapper ul.pagination li span.current {
      background: var(--accent-primary); color: #fff; font-weight: bold; cursor: default;
    }
    .pagination-wrapper ul.pagination li span.dots { padding: 9px 12px; background-color: var(--bg-tertiary); color: var(--text-secondary); cursor: default; }
    .pagination-wrapper ul.pagination li button:disabled {
        background-color: var(--bg-tertiary);
        color: var(--text-secondary);
        cursor: not-allowed;
        opacity: 0.7;
    }

    footer.primary-footer { 
      margin-top: 30px; 
      color: var(--text-secondary); 
      background: var(--bg-secondary); 
      padding: 25px 0; 
      font-size: 0.9em; 
      border-top: 2px solid var(--border-color); 
      box-shadow: 0 -2px 5px rgba(0,0,0,0.05); 
    }
    footer.primary-footer .container { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
    footer.primary-footer .footer-brand p { margin: 5px 0; }
    footer.primary-footer .footer-brand span a { font-weight: 600; color: var(--accent-primary) !important; }
    footer.primary-footer .footer-links ul { list-style: none; display: flex; flex-wrap: wrap; padding: 0; margin: 5px 0; }
    footer.primary-footer .footer-links ul li { margin-left: 15px; } 
    footer.primary-footer .footer-links ul li a { color: var(--text-secondary); }
    footer.primary-footer .footer-links ul li a:hover { color: var(--accent-primary); text-decoration: underline !important; }

    .status-message { grid-column: 1 / -1; text-align: center; font-size: 1.1em; color: var(--text-secondary); padding: 30px 20px; border-radius: 6px; background-color: var(--bg-tertiary); margin: 20px 0; border: 1px solid var(--border-color); box-shadow: 0 2px 4px var(--card-shadow); }
    .status-message.error { color: var(--error-color); border-color: var(--error-color); background-color: color-mix(in srgb, var(--error-color) 15%, transparent); }
    .status-message.success { color: var(--success-color); border-color: var(--success-color); background-color: color-mix(in srgb, var(--success-color) 15%, transparent); }
    .loading-spinner { width: 40px; height: 40px; border: 4px solid var(--border-color); border-top-color: var(--accent-primary); border-radius: 50%; animation: spin 0.9s linear infinite; margin: 0 auto 10px auto; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .movie-modal {
      display: none; position: fixed; z-index: 1005; left: 0; top: 0;
      width: 100%; height: 100%; overflow: auto;
      background-color: color-mix(in srgb, var(--bg-primary) 70%, transparent); /* Semi-transparent backdrop based on theme */
      backdrop-filter: blur(10px); 
    }
    .movie-modal-content {
      background-color: var(--modal-bg); /* Using theme variable for glassmorphism */
      backdrop-filter: blur(15px) saturate(180%); /* Glassmorphism effect */
      -webkit-backdrop-filter: blur(15px) saturate(180%); /* Safari */
      margin: 3% auto; 
      padding: 25px 30px; 
      border: 1px solid var(--modal-border); /* Theme variable for border */
      border-radius: 12px; /* More rounded for glass effect */
      width: 90%; max-width: 800px; 
      box-shadow: 0 10px 30px var(--card-shadow); 
      position: relative; animation: modalAppear 0.4s ease-out;
    }
    @keyframes modalAppear {
        from { opacity: 0; transform: scale(0.92) translateY(-25px); }
        to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .modal-close-button {
      color: var(--text-secondary); position: absolute; top: 15px; right: 20px;
      font-size: 32px; font-weight: bold; line-height: 1;
      transition: color 0.2s ease, transform 0.2s ease;
    }
    .modal-close-button:hover, .modal-close-button:focus {
      color: var(--accent-primary); text-decoration: none; cursor: pointer; transform: scale(1.1);
    }
    .modal-top-section { display: flex; gap: 25px; margin-bottom: 20px; }
    .modal-poster {
      width: 200px; 
      min-width: 200px;
      height: auto; border-radius: 8px; /* Smoother radius */
      object-fit: cover;
      border: 2px solid var(--border-color);
      box-shadow: 0 4px 10px var(--card-shadow);
    }
    .modal-header-info { flex-grow: 1; text-align: left; display: flex; flex-direction: column; justify-content: center; }
    .modal-movie-title {
        font-family: 'Rajdhani', sans-serif;
        font-size: 2.4em; 
        color: var(--accent-primary);
        margin-bottom: 15px; 
        line-height: 1.25;
        text-align: left;
        font-weight: 700; 
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .modal-movie-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Wider items */
        gap: 12px; 
        margin-top: 12px;
    }
    .modal-info-item {
        display: flex;
        align-items: center; 
        font-size: 0.95em; 
        color: var(--text-secondary);
        padding: 12px; /* More padding */
        line-height: 1.5;
        background-color: color-mix(in srgb, var(--bg-tertiary) 80%, transparent); /* Slightly transparent for glass */
        border-radius: 6px;
        border-left: 4px solid var(--accent-secondary); 
        transition: background-color 0.3s ease;
    }
    .modal-info-item:hover {
        background-color: color-mix(in srgb, var(--bg-tertiary) 50%, transparent);
    }
    .modal-info-item i {
        color: var(--accent-secondary); 
        margin-right: 10px;
        font-size: 1.2em; 
        width: 22px; 
        text-align: center;
    }
    .modal-info-label {
        font-weight: 600; 
        color: var(--text-primary);
        margin-right: 6px;
    }
    .modal-info-value {
        color: var(--text-secondary);
        flex-grow: 1;
    }

    .modal-movie-description { margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: left; }
    .modal-movie-description h4 { color: var(--accent-secondary); margin-bottom: 10px; font-size: 1.2em; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 0.5px;}
    .modal-movie-description p { font-size: 1em; line-height: 1.75; color: var(--text-secondary); }

    .modal-screenshots { margin-top: 25px; text-align: left;}
    .modal-screenshots h4 { color: var(--accent-secondary); margin-bottom: 12px; font-size: 1.2em; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 0.5px;}
    .screenshots-gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; }
    .screenshots-gallery img { width: 100%; height: auto; border-radius: 5px; border: 1px solid var(--border-color); cursor: pointer; transition: transform 0.25s ease, box-shadow 0.25s ease, opacity 0.2s ease; }
    .screenshots-gallery img:hover { transform: scale(1.1); box-shadow: 0 0 12px var(--accent-primary); opacity: 0.9; }

    .modal-download-section {
        margin-top: 30px;
        padding-top: 25px;
        border-top: 1px solid var(--border-color);
        text-align: center;
    }
    .modal-download-section .download-section-main-title {
        font-size: 1.2em; 
        font-weight: 600; 
        color: var(--text-primary);
        margin-bottom: 8px;
        text-align: left;
        font-family: 'Rajdhani', sans-serif;
    }
    .modal-download-section .download-section-subtitle { 
        font-size: 1.05em; 
        font-weight: bold;
        color: var(--download-section-title-color); 
        margin-bottom: 18px; 
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .download-links-container { display: flex; flex-direction: column; gap: 10px; }
    .download-link-item {
        display: block; 
        background-color: var(--bg-tertiary);
        color: var(--download-link-color) !important;
        padding: 12px 18px; 
        border-radius: 5px;
        text-align: center;
        font-weight: 600; 
        font-size: 1em; 
        border: 1px solid var(--border-color);
        transition: background-color 0.25s ease, color 0.25s ease, border-color 0.25s ease, transform 0.2s ease;
        box-shadow: 0 2px 4px var(--card-shadow);
    }
    .download-link-item:hover {
        background-color: var(--accent-primary);
        color: #fff !important;
        border-color: var(--accent-primary-darker);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px color-mix(in srgb, var(--accent-primary) 30%, transparent);
    }
    .download-link-item i { margin-right: 10px; font-size: 1.1em; }

    /* Back to Top Button */
    #backToTopBtn {
        display: none;
        position: fixed;
        bottom: 25px;
        right: 25px;
        z-index: 1000;
        background-color: var(--accent-primary);
        color: white;
        border: none;
        border-radius: 50%; /* Circular button */
        width: 50px;
        height: 50px;
        font-size: 1.3em; /* Icon size */
        cursor: pointer;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        transition: background-color 0.3s ease, transform 0.3s ease, opacity 0.3s ease;
        opacity: 0.8;
    }
    #backToTopBtn:hover {
        background-color: var(--accent-primary-darker);
        transform: scale(1.1);
        opacity: 1;
    }


    @media (max-width: 1024px) { 
        nav.category-navbar .category-toggle { display: block; }
        nav.category-navbar .left-group { overflow: visible; }
        .inline-mobile-search-form { display: flex; }
        nav.category-navbar .search-container { display: none; } 
        #categoryLinks #mobile-search-item { display: none !important; }

        ul.category-links { 
            display: none; flex-direction: column; position: fixed;
            top: 0; left: -100%; width: 85%; max-width: 300px; height: 100vh;
            background-color: var(--bg-secondary);
            padding-top: 20px; transition: left 0.35s ease-in-out;
            z-index: 2000; overflow-y: auto;
            border-right: 1px solid var(--border-color);
            box-shadow: 3px 0 10px var(--card-shadow);
        }
        ul.category-links.active { left: 0; display: flex; }
        ul.category-links li { width: 100%; margin-right: 0; border-bottom: 1px solid var(--border-color); }
        ul.category-links li:last-child { border-bottom: none; }
        ul.category-links li a { padding: 14px 20px; color: var(--text-primary); font-size: 1em; }
        ul.category-links li a:hover { background-color: var(--accent-primary); color: #fff; }
        ul.category-links li .dropdown-menu {
            position: static; background-color: var(--bg-primary);
            box-shadow: none; border-radius: 0; border: none; padding-left: 25px;
        }
        ul.category-links li .dropdown-menu li a { font-size: 0.95em; color: var(--text-secondary); }

        a.custom-button-4khdhub {
            font-size: 0.85em; 
            padding: 0 12px; 
            height: 38px; 
            margin-right: 10px; 
        }
        .inline-mobile-search-form { margin-left: 12px; }
        .inline-mobile-search-form input[type="search"] {
            width: 130px; 
            font-size: 0.85em; 
            height: 38px;
            padding: 0 12px;
        }
        .inline-mobile-search-form button {
            height: 38px;
            font-size: 0.9em; 
            padding: 0 12px;
        }
        .modal-movie-title { font-size: 2.1em; } 
        .modal-poster { width: 180px; min-width: 180px;}
        #backToTopBtn { bottom: 20px; right: 20px; width: 45px; height: 45px; font-size: 1.2em; }
    }

    @media (max-width: 767px) { 
        ul.recent-movies-grid {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); 
            gap: 0.9rem;
        }
        li.movie-card-item figure img { height: 230px; } 
        li.movie-card-item figcaption { min-height: 65px; padding: 10px; }
        li.movie-card-item figcaption p.movie-title-link { font-size: 0.9em; }

        .modal-top-section { flex-direction: column; align-items: stretch; text-align: left; }
        .modal-poster { align-self: center; float: none; margin-right: 0; margin-bottom: 18px; width: 70%; max-width: 220px; }
        .modal-header-info { text-align: left;}
        .modal-movie-title { font-size: 1.9em; text-align: center; }
        .modal-movie-info-grid { grid-template-columns: 1fr; }

        a.custom-button-4khdhub {
            font-size: 0.8em; 
            padding: 0 10px; 
            height: 36px;
            margin-right: 8px; 
        }
        .inline-mobile-search-form { margin-left: 10px; }
        .inline-mobile-search-form input[type="search"] {
            width: 100px; 
            font-size: 0.8em;
            height: 36px;
            padding: 0 10px;
        }
        .inline-mobile-search-form button {
            height: 36px;
            font-size: 0.85em;
            padding: 0 10px;
        }
        h2.section-category-name { font-size: 1.4em; }
        .modal-download-link-item { font-size: 0.9em; padding: 10px 15px; }
        #backToTopBtn { bottom: 15px; right: 15px; width: 40px; height: 40px; font-size: 1.1em;}
        .theme-toggle-button { padding: 7px 9px; font-size: 1em; }
        .primary-header .navbar-brand img.site-logo { height: 45px; }
        .site-title-text { font-size: 1.9em; }
    }
     @media (max-width: 480px) {
        ul.recent-movies-grid { grid-template-columns: repeat(2, 1fr); gap: 0.7rem; }
        li.movie-card-item figure img { height: 200px; }
        .primary-header .navbar-brand img.site-logo { height: 40px; }
        .site-title-text { font-size: 1.7em; }
        .modal-movie-title { font-size: 1.6em; }
        .modal-info-item { font-size: 0.85em; }
        .modal-info-item i { font-size: 1em; margin-right: 8px; }
        .download-link-item { font-size: 0.9em; padding: 10px; }
        .download-link-item i { margin-right: 6px; }
    }
  </style>
</head>
<body>

  <header class="primary-header">
    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">
             <img src="FlixHutHD.png" alt="FlixHutHD Logo" class="site-logo" onerror="this.style.display='none'; this.onerror=null; const span = document.createElement('span'); span.className='site-title-text'; span.textContent='FlixHutHD'; this.parentNode.replaceChild(span, this);">
          </a>
        </div>
        <button class="theme-toggle-button" id="themeToggle" aria-label="Toggle theme">
            <i class="fas fa-moon"></i>
            <i class="fas fa-sun"></i>
        </button>
      </div>
    </nav>
    <div class="carousel-slider-container" id="carouselImageSlider">
        <div class="carousel-slider-wrapper">
            <!-- Carousel slides will be injected by JavaScript -->
        </div>
    </div>

    <nav class="category-navbar">
      <div class="container">
        <button type="button" class="category-toggle" id="categoryMenuToggle">
          <i class="fas fa-bars"></i>
        </button>
        <div class="left-group">
          <a href="#" class="custom-button-4khdhub">
            <i class="fa fa-film"></i> 4kFlixHD
          </a>
          <form id="inlineMobileSearchForm" class="inline-mobile-search-form">
            <input type="search" name="s" placeholder="Search..." autocomplete="off">
            <button type="submit"><i class="fas fa-search"></i></button>
          </form>
          <ul class="category-links" id="categoryLinks">
            <li id="mobile-search-item" style="display: none;"> 
                <form method="get" id="mobileSearchFormInMenu" action="#">
                    <input type="search" name="s" placeholder="Search here..." autocomplete="off">
                </form>
            </li>
            <li><a href="#" data-category="All" class="active-category-link">Home <i class="fas fa-home fa-xs" style="margin-left: 5px;"></i></a></li>
            <li><a href="#" data-category="Bollywood">Bollywood</a></li>
            <li><a href="#" data-category="Hollywood">Hollywood</a></li>
            <li><a href="#" data-category="Hindi Dubbed">Hindi Dubbed</a></li>
            <li><a href="#" data-category="South Hindi">South Hindi</a></li>
            <li class="dropdown">
              <a href="#">Genres <span class="arrow">▾</span></a>
              <ul class="dropdown-menu">
                <li><a href="#" data-category="Action">Action</a></li>
                <li><a href="#" data-category="Comedy">Comedy</a></li>
                <li><a href="#" data-category="Horror">Horror</a></li>
                <li><a href="#" data-category="Sci-Fi">Sci-Fi</a></li>
                <li><a href="#" data-category="Romance">Romance</a></li>
                <li><a href="#" data-category="Thriller">Thriller</a></li>
                <li><a href="#" data-category="Drama">Drama</a></li>
              </ul>
            </li>
            <li><a href="#" data-category="Web Series">Web Series</a></li>
            <li><a href="#" data-category="Anime">Anime</a></li>
            <li><a href="#" data-category="Cartoon">Cartoon</a></li>
            <li><a href="#" data-category="Other">Other</a></li>
          </ul>
        </div>
        <div class="search-container" id="desktopSearchContainer"> 
          <form method="get" action="#" id="desktopSearchForm">
            <input type="search" name="s" id="desktopSearchInput" class="form-control" placeholder="Search movies..." autocomplete="off">
            <button type="submit"><i class="fas fa-search"></i></button>
          </form>
        </div>
      </div>
    </nav>
  </header>

  <div class="container">
    <section class="sitewide-notice">
        <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
        Stay updated! Follow us on our <a href="#">Telegram Channel</a> for the latest movies.
    </section>

    <section class="home-wrapper">
      <h2 class="section-category-name" id="currentCategoryTitle">
        <i class="fas fa-bolt"></i>
        <span>All Movies</span>
      </h2>
      <ul class="recent-movies-grid" id="movies-grid">
        <!-- Movies will be loaded here by JavaScript -->
      </ul>
      <div class="clearfix" style="clear:both;"></div>

      <div class="pagination-wrapper" id="paginationControls">
        <!-- Pagination buttons will be generated here -->
      </div>
    </section>
  </div>

  <footer class="primary-footer">
    <div class="container">
      <div class="footer-brand">
        <p>&copy; <span id="currentYear">2025</span> <span><a href="#">FlixHutHD</a></span> | All Rights Reserved.</p>
      </div>
      <div class="footer-links">
        <ul>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- Movie Detail Modal -->
  <div id="movieDetailModal" class="movie-modal">
    <div class="movie-modal-content">
      <span class="modal-close-button">&times;</span>
      <div class="modal-top-section">
        <img src="" alt="Movie Poster" class="modal-poster" id="modalPoster">
        <div class="modal-header-info">
            <h3 class="modal-movie-title" id="modalTitle">Movie Title</h3>
            <div class="modal-movie-info-grid">
                <div class="modal-info-item">
                    <i class="fas fa-film"></i>
                    <div>
                        <span class="modal-info-label">Category:</span>
                        <span class="modal-info-value" id="modalCategory">N/A</span>
                    </div>
                </div>
                <div class="modal-info-item">
                    <i class="fas fa-star"></i>
                    <div>
                        <span class="modal-info-label">IMDb:</span>
                        <span class="modal-info-value" id="modalImdbRating">N/A</span>
                    </div>
                </div>
                <div class="modal-info-item">
                    <i class="fas fa-users"></i>
                    <div>
                        <span class="modal-info-label">Stars:</span>
                        <span class="modal-info-value" id="modalStars">N/A</span>
                    </div>
                </div>
                <div class="modal-info-item">
                    <i class="fas fa-clapperboard"></i> 
                    <div>
                        <span class="modal-info-label">Director:</span>
                        <span class="modal-info-value" id="modalDirector">N/A</span>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <div class="modal-movie-description">
        <h4>Description:</h4>
        <p id="modalDescription">No description available.</p>
      </div>

      <div class="modal-screenshots">
        <h4>Screenshots:</h4>
        <div class="screenshots-gallery" id="modalScreenshotsGallery">
          <!-- Screenshots will be populated here -->
        </div>
      </div>
      <div class="modal-download-section">
        <h3 class="download-section-main-title" id="modalDownloadMainTitle">Download Movie Title Full Movie in Hindi | HD</h3>
        <h4 class="download-section-subtitle">: DOWNLOAD MOVIE  :</h4>
        <div class="download-links-container" id="modalDownloadLinksContainer">
            <a href="#" id="download480pButton" class="download-link-item" target="_blank"><i class="fas fa-download"></i> DOWNLOAD 480P</a>
            <a href="#" id="download720pButton" class="download-link-item" target="_blank"><i class="fas fa-download"></i> DOWNLOAD 720P</a>
            <a href="#" id="download1080pButton" class="download-link-item" target="_blank"><i class="fas fa-download"></i> DOWNLOAD 1080P</a>
            <a href="#" id="download4kButton" class="download-link-item" target="_blank"><i class="fas fa-download"></i> DOWNLOAD 4K</a>
            <p id="noDownloadLinksMessage" style="color: var(--text-secondary); font-size: 0.9em; display: none;">No download links available.</p>
        </div>
      </div>
    </div>
  </div>

  <button id="backToTopBtn" title="Go to top"><i class="fas fa-arrow-up"></i></button>

  <script type="module">
    // Firebase and DOM Elements Initialization
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDS3t1LHKVXcsu2c3G2fR1dmD_Ts_9R95o", // User's Firebase API Key
      authDomain: "flixhuthd.firebaseapp.com",
      projectId: "flixhuthd",
      storageBucket: "flixhuthd.appspot.com",
      messagingSenderId: "716214559037",
      appId: "1:716214559037:web:5d26537a8ba8282f47e554",
      measurementId: "G-TLELC9VFL2"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM Element variables
    const movieContainer = document.getElementById('movies-grid');
    const categoryLinksContainer = document.getElementById('categoryLinks');
    const currentCategoryTitleEl = document.getElementById('currentCategoryTitle').querySelector('span');
    const paginationControls = document.getElementById('paginationControls');
    const modal = document.getElementById("movieDetailModal");
    const modalCloseButton = modal.querySelector(".modal-close-button");
    const modalPoster = document.getElementById("modalPoster");
    const modalTitle = document.getElementById("modalTitle");
    const modalCategory = document.getElementById("modalCategory");
    const modalImdbRating = document.getElementById("modalImdbRating");
    const modalStars = document.getElementById("modalStars");
    const modalDirector = document.getElementById("modalDirector");
    const modalDescription = document.getElementById("modalDescription");
    const modalScreenshotsGallery = document.getElementById("modalScreenshotsGallery");
    const modalDownloadMainTitle = document.getElementById("modalDownloadMainTitle");
    
    const download480pButton = document.getElementById('download480pButton');
    const download720pButton = document.getElementById('download720pButton');
    const download1080pButton = document.getElementById('download1080pButton');
    const download4kButton = document.getElementById('download4kButton');
    const noDownloadLinksMessage = document.getElementById('noDownloadLinksMessage');

    const sliderWrapper = document.querySelector("#carouselImageSlider .carousel-slider-wrapper");
    const themeToggleButton = document.getElementById('themeToggle');
    const backToTopButton = document.getElementById('backToTopBtn');


    // Global variables
    let sliderImages = [];
    let scrollAmount = 0;
    const slideItemWidth = 160 + 20; 
    let animationFrameId;
    let allMoviesData = [];
    let currentFilteredMovies = [];
    let currentPage = 1;
    const moviesPerPage = 18; 

    // Theme Switcher Logic
    function applyTheme(theme) {
        if (theme === 'light') {
            document.body.classList.add('light-theme');
            document.body.classList.remove('dark-theme');
        } else {
            document.body.classList.add('dark-theme');
            document.body.classList.remove('light-theme');
        }
        localStorage.setItem('flixhuthd-theme', theme);
    }

    if (themeToggleButton) {
        themeToggleButton.addEventListener('click', () => {
            const currentTheme = localStorage.getItem('flixhuthd-theme') || 'dark';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
        });
    }
    // Load saved theme
    const savedTheme = localStorage.getItem('flixhuthd-theme');
    if (savedTheme) {
        applyTheme(savedTheme);
    } else {
        applyTheme('dark'); // Default to dark
    }


    // Back to Top Button Logic
    if (backToTopButton) {
        window.onscroll = function() {
            if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
                backToTopButton.style.display = "block";
                backToTopButton.style.opacity = "1";
            } else {
                backToTopButton.style.opacity = "0";
                // Optional: hide after fade out
                setTimeout(() => {
                    if (!(document.body.scrollTop > 100 || document.documentElement.scrollTop > 100)) {
                         backToTopButton.style.display = "none";
                    }
                }, 300); // Match transition duration
            }
        };
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }


    function setCurrentFooterYear() {
        const yearSpan = document.getElementById('currentYear');
        if (yearSpan) {
            yearSpan.textContent = new Date().getFullYear();
        }
    }

    function createSlider() {
        if (!sliderWrapper) { console.warn("Slider wrapper not found."); return; }
        // Prioritize movies with posters for the slider
        sliderImages = allMoviesData
            .filter(movie => movie.data.poster && movie.data.poster.trim() !== "")
            .map(movie => movie.data.poster)
            .slice(0, 15); 

        if (sliderImages.length === 0) {
             sliderWrapper.innerHTML = `<div class="carousel-slide-item" style="width:100%; height:100%; margin:0; display:flex; align-items:center; justify-content:center; background-color: var(--bg-tertiary);">
                                            <span style="color: var(--text-secondary);">No featured movies.</span>
                                        </div>`;
            stopContinuousSlide(); 
            return;
        }
        sliderWrapper.innerHTML = ''; 
        
        const viewportWidth = sliderWrapper.parentElement.offsetWidth || 1200; 
        const numDuplicates = Math.max(3, Math.ceil( (viewportWidth * 2.5) / (sliderImages.length * slideItemWidth) )); // Increased factor for smoother loop

        let duplicatedImages = [];
        for(let i = 0; i < numDuplicates; i++) {
            duplicatedImages = duplicatedImages.concat(sliderImages);
        }

        duplicatedImages.forEach((imgPath) => {
            const slideDiv = document.createElement('div');
            slideDiv.classList.add('carousel-slide-item');
            const originalMovie = allMoviesData.find(movie => movie.data.poster === imgPath); 
            if (originalMovie) {
                slideDiv.setAttribute('data-movie-id', originalMovie.id);
                slideDiv.addEventListener('click', function() { openMovieModal(this.dataset.movieId); });
            }

            const img = document.createElement('img');
            img.src = imgPath;
            img.alt = "Promotional Slide";
            img.loading = "lazy"; // Lazy load slider images
            img.onerror = function() { 
                this.src=`https://placehold.co/160x170/${getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary').trim().substring(1)}/${getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim().substring(1)}?text=Error`; 
                this.alt='Image load error'; 
            };
            slideDiv.appendChild(img);
            sliderWrapper.appendChild(slideDiv);
        });
        startContinuousSlide();
    }

    function continuousScroll() {
        if (!sliderWrapper || sliderImages.length === 0 || sliderImages.length * slideItemWidth < sliderWrapper.parentElement.offsetWidth) { // Stop if not enough content to scroll
            stopContinuousSlide();
            return;
        }
        scrollAmount += 0.5; 
        sliderWrapper.style.transform = `translateX(-${scrollAmount}px)`;
        
        const totalWidthOriginalSlides = sliderImages.length * slideItemWidth;

        if (scrollAmount >= totalWidthOriginalSlides) {
            scrollAmount = 0; 
            sliderWrapper.style.transition = 'none'; 
            sliderWrapper.style.transform = 'translateX(0px)';
            void sliderWrapper.offsetWidth; 
            sliderWrapper.style.transition = ''; 
        }
        animationFrameId = requestAnimationFrame(continuousScroll);
    }
    
    function stopContinuousSlide() {
        cancelAnimationFrame(animationFrameId);
    }

    function startContinuousSlide() {
        if (sliderImages.length === 0 || !sliderWrapper || sliderImages.length * slideItemWidth < sliderWrapper.parentElement.offsetWidth) {
            stopContinuousSlide();
            // Clear transform if not enough items
            if (sliderWrapper) sliderWrapper.style.transform = 'translateX(0px)';
            return;
        }
        stopContinuousSlide(); 
        scrollAmount = 0; 
        sliderWrapper.style.transform = 'translateX(0px)'; 
        animationFrameId = requestAnimationFrame(continuousScroll); 
    }
    
    function openMovieModal(movieId) {
        const movie = allMoviesData.find(m => m.id === movieId);
        if (!movie || !movie.data) { console.error("Movie data not found for ID:", movieId); return; }
        const data = movie.data; 

        modalPoster.src = data.poster || `https://placehold.co/200x300/${getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary').trim().substring(1)}/${getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim().substring(1)}?text=${encodeURIComponent(data.name || "No Poster")}`;
        modalPoster.alt = `${data.name || "Movie"} Poster`;
        modalTitle.textContent = data.name || "Title Not Available";
        modalCategory.textContent = data.category || "N/A";
        modalImdbRating.textContent = data.imdbRating || "N/A";
        modalStars.textContent = data.stars || "N/A";
        modalDirector.textContent = data.director || "N/A";
        modalDescription.textContent = data.description || "No description available.";
        
        modalDownloadMainTitle.textContent = `Download ${data.name || 'Movie'}`;
        
        if(download480pButton) download480pButton.style.display = 'none';
        if(download720pButton) download720pButton.style.display = 'none';
        if(download1080pButton) download1080pButton.style.display = 'none';
        if(download4kButton) download4kButton.style.display = 'none';
        if(noDownloadLinksMessage) noDownloadLinksMessage.style.display = 'none';
        
        let linksWereActuallySet = false;

        const qualityButtonMap = [
            { button: download480pButton,  regex: /480p/i, alt: ['sd', 'standard', '480'] },
            { button: download720pButton,  regex: /720p|hd/i, alt: ['hd ready', '720'] },
            { button: download1080pButton, regex: /1080p|fhd|fullhd/i, alt: ['full hd', '1080'] },
            { button: download4kButton,    regex: /4k|uhd|2160p|ultra.?hd/i, alt: ['ultra hd', '2160'] }
        ];

        if (data.downloadLinks && typeof data.downloadLinks === 'object') {
            qualityButtonMap.forEach(qMap => {
                if (!qMap.button) { 
                     console.warn(`Button for quality (regex: ${qMap.regex}) not found in HTML for movie: ${data.name}`);
                     return; 
                }
                let linkUrl = null;
                for (const keyInFirebase in data.downloadLinks) {
                    if (data.downloadLinks.hasOwnProperty(keyInFirebase) && typeof data.downloadLinks[keyInFirebase] === 'string') {
                        const lowerKey = keyInFirebase.toLowerCase();
                        if (qMap.regex.test(lowerKey) || (qMap.alt && qMap.alt.some(altKey => lowerKey.includes(altKey.toLowerCase())))) {
                            linkUrl = data.downloadLinks[keyInFirebase];
                            break; 
                        }
                    }
                }
                if (linkUrl && linkUrl.trim() !== "") {
                    qMap.button.href = linkUrl;
                    qMap.button.style.display = 'block'; 
                    linksWereActuallySet = true;
                } else {
                    qMap.button.style.display = 'none'; 
                }
            });
        }
        
        if (!linksWereActuallySet && data.url && data.url.trim() !== "") {
            if (download1080pButton) { 
                download1080pButton.href = data.url;
                download1080pButton.style.display = 'block';
                linksWereActuallySet = true;
            }
        }

        if (!linksWereActuallySet && noDownloadLinksMessage) {
            noDownloadLinksMessage.style.display = 'block';
        }

        modalScreenshotsGallery.innerHTML = ''; 
        let screenshotUrls = [];
        if (Array.isArray(data.screenshots)) {
            screenshotUrls = data.screenshots.filter(url => url && url.trim() !== "");
        } else if (typeof data.screenshots === 'string' && data.screenshots.trim() !== "") {
            screenshotUrls = data.screenshots.split(',').map(url => url.trim()).filter(url => url);
        }

        if (screenshotUrls.length > 0) {
            screenshotUrls.forEach(ssUrl => {
                const img = document.createElement('img');
                img.src = ssUrl;
                img.alt = "Screenshot";
                img.loading = "lazy"; // Lazy load screenshots
                img.onerror = function() { this.src=`https://placehold.co/120x70/${getComputedStyle(document.documentElement).getPropertyValue('--bg-tertiary').trim().substring(1)}/${getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim().substring(1)}?text=No+SS`; }; 
                modalScreenshotsGallery.appendChild(img);
            });
        } else {
            modalScreenshotsGallery.innerHTML = '<p style="color: var(--text-secondary); font-size: 0.9em;">No screenshots available.</p>';
        }

        modal.style.display = "block";
        document.body.classList.add("modal-open"); 
    }

    if (modalCloseButton) {
        modalCloseButton.onclick = function() { modal.style.display = "none"; document.body.classList.remove("modal-open"); }
    }
    window.onclick = function(event) {
        if (event.target == modal) { modal.style.display = "none"; document.body.classList.remove("modal-open"); }
    }

    function renderMovies(page = 1) {
        if (!movieContainer) { console.error("Movie container not found."); return; }
        movieContainer.innerHTML = ''; 
        currentPage = page;
        const startIndex = (currentPage - 1) * moviesPerPage;
        const endIndex = startIndex + moviesPerPage;
        const moviesToDisplay = currentFilteredMovies.slice(startIndex, endIndex);

        if (!moviesToDisplay || moviesToDisplay.length === 0) {
            movieContainer.innerHTML = '<div class="status-message">No movies found for this criteria.</div>';
            setupPagination(currentFilteredMovies.length, moviesPerPage, currentPage); 
            return;
        }

        moviesToDisplay.forEach((movieData) => {
            const data = movieData.data;
            const id = movieData.id;
            const movieEl = document.createElement('li');
            movieEl.classList.add('movie-card-item');
            movieEl.setAttribute('data-movie-id', id);

            const bgColorPlaceholder = getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary').trim().substring(1) || '1A1A1A';
            const textColorPlaceholder = getComputedStyle(document.documentElement).getPropertyValue('--text-primary').trim().substring(1) || 'F0F0F0';
            const posterUrl = data.poster || `https://placehold.co/340x510/${bgColorPlaceholder}/${textColorPlaceholder}?text=${encodeURIComponent(data.name || "No Name")}`;
            
            movieEl.innerHTML = `
                <figure>
                  <img src="${posterUrl}" alt="${data.name || "Movie"} Poster" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/340x510/${bgColorPlaceholder}/${getComputedStyle(document.documentElement).getPropertyValue('--text-secondary').trim().substring(1)}?text=Not+Found';">
                </figure>
                <figcaption>
                  <p class="movie-title-link">${data.name || "Untitled Movie"}</p>
                </figcaption>`;
            movieEl.addEventListener('click', function() { openMovieModal(this.dataset.movieId); });
            movieContainer.appendChild(movieEl);
        });
        setupPagination(currentFilteredMovies.length, moviesPerPage, currentPage);
    }

    function setupPagination(totalItems, itemsPerPage, page) {
        if (!paginationControls) { console.warn("Pagination controls container not found."); return; }
        paginationControls.innerHTML = ""; 
        const pageCount = Math.ceil(totalItems / itemsPerPage);
        if (pageCount <= 1) return; 

        const ul = document.createElement('ul');
        ul.classList.add('pagination');

        const prevButton = document.createElement('button');
        prevButton.innerHTML = '<i class="fas fa-angle-left"></i> Prev';
        prevButton.disabled = page === 1;
        prevButton.addEventListener('click', () => { if (page > 1) renderMovies(page - 1); });
        const prevLi = document.createElement('li');
        prevLi.appendChild(prevButton);
        ul.appendChild(prevLi);

        let startPage = Math.max(1, page - 2);
        let endPage = Math.min(pageCount, page + 2);
        if (page <= 3) endPage = Math.min(pageCount, 5); 
        if (page > pageCount - 3) startPage = Math.max(1, pageCount - 4); 

        if (startPage > 1) {
            const firstPageButton = document.createElement('button');
            firstPageButton.textContent = '1';
            firstPageButton.addEventListener('click', () => renderMovies(1));
            const firstLi = document.createElement('li');
            firstLi.appendChild(firstPageButton);
            ul.appendChild(firstLi);
            if (startPage > 2) {
                 const dots = document.createElement('span');
                 dots.classList.add('dots'); dots.textContent = '...';
                 const dotsLi = document.createElement('li');
                 dotsLi.appendChild(dots); ul.appendChild(dotsLi);
            }
        }

        for (let i = startPage; i <= endPage; i++) {
            const pageButton = document.createElement('button');
            pageButton.textContent = i;
            if (i === page) { pageButton.classList.add('current-page'); pageButton.disabled = true; }
            pageButton.addEventListener('click', () => renderMovies(i));
            const li = document.createElement('li');
            li.appendChild(pageButton); ul.appendChild(li);
        }

        if (endPage < pageCount) {
            if (endPage < pageCount - 1) {
                const dots = document.createElement('span');
                dots.classList.add('dots'); dots.textContent = '...';
                const dotsLi = document.createElement('li');
                dotsLi.appendChild(dots); ul.appendChild(dotsLi);
            }
            const lastPageButton = document.createElement('button');
            lastPageButton.textContent = pageCount;
            lastPageButton.addEventListener('click', () => renderMovies(pageCount));
            const lastLi = document.createElement('li');
            lastLi.appendChild(lastPageButton); ul.appendChild(lastLi);
        }

        const nextButton = document.createElement('button');
        nextButton.innerHTML = 'Next <i class="fas fa-angle-right"></i>';
        nextButton.disabled = page === pageCount;
        nextButton.addEventListener('click', () => { if (page < pageCount) renderMovies(page + 1); });
        const nextLi = document.createElement('li');
        nextLi.appendChild(nextButton);
        ul.appendChild(nextLi);

        paginationControls.appendChild(ul);
    }
    
    function filterAndDisplayMovies(category) {
        document.querySelectorAll('#categoryLinks a[data-category]').forEach(link => {
            link.classList.remove('active-category-link');
            if (link.dataset.category.toLowerCase() === category.toLowerCase()) { link.classList.add('active-category-link'); }
        });
        if (currentCategoryTitleEl) { currentCategoryTitleEl.textContent = category.toLowerCase() === "all" ? "All Movies" : category; }
        
        const desktopSearchInput = document.getElementById('desktopSearchInput');
        if(desktopSearchInput) { desktopSearchInput.value = ''; }
        const inlineMobileSearchInput = document.querySelector('#inlineMobileSearchForm input[name="s"]');
        if(inlineMobileSearchInput) { inlineMobileSearchInput.value = ''; }

        if (category.toLowerCase() === "all") { currentFilteredMovies = [...allMoviesData]; }
        else { currentFilteredMovies = allMoviesData.filter(movie => movie.data.category && movie.data.category.toLowerCase() === category.toLowerCase()); } 
        renderMovies(1); 
    }

    async function loadAllMovies() {
      if (!movieContainer) { console.error("Movie container not found, cannot load movies."); return; }
      movieContainer.innerHTML = '<div id="loadingIndicator" class="status-message"><div class="loading-spinner"></div><p>Loading Movies...</p></div>';
      if (paginationControls) paginationControls.innerHTML = ''; 
      try {
        const querySnapshot = await getDocs(collection(db, "movies"));
        allMoviesData = []; 
        querySnapshot.forEach((doc) => { allMoviesData.push({ id: doc.id, data: doc.data() }); });
        
        allMoviesData.sort((a, b) => (b.data.timestamp?.seconds || 0) - (a.data.timestamp?.seconds || 0)); // Sort by Firestore timestamp

        createSlider(); 

        currentFilteredMovies = [...allMoviesData]; 
        filterAndDisplayMovies("All"); 

      } catch (error) {
        console.error("Error loading all movies: ", error);
        movieContainer.innerHTML = `<div class="status-message error"><i class="fas fa-exclamation-triangle"></i> Error loading movies. Details: ${error.message}. Please try again later.</div>`;
        createSlider(); 
      }
    }

    if (categoryLinksContainer) {
        categoryLinksContainer.addEventListener('click', function(event) {
            const targetLink = event.target.closest('a[data-category]');
            if (targetLink) {
                event.preventDefault();
                const category = targetLink.dataset.category;
                filterAndDisplayMovies(category);
                if (window.innerWidth <= 1024 && categoryLinksUl && categoryLinksUl.classList.contains("active")) {
                    categoryLinksUl.classList.remove("active");
                    document.body.classList.remove("category-menu-open");
                }
            }
        });
    }

    const categoryMenuToggle = document.getElementById("categoryMenuToggle");
    const categoryLinksUl = document.getElementById("categoryLinks");
    const desktopSearch = document.getElementById("desktopSearchContainer"); 

    if (categoryMenuToggle && categoryLinksUl) {
        categoryMenuToggle.addEventListener("click", function(e) {
            e.stopPropagation(); 
            const isActive = categoryLinksUl.classList.toggle("active");
            document.body.classList.toggle("category-menu-open", isActive); 
        });
    }
    document.addEventListener("click", function(e) {
        if (categoryLinksUl && categoryMenuToggle && categoryLinksUl.classList.contains("active")) {
            if (!categoryLinksUl.contains(e.target) && !categoryMenuToggle.contains(e.target)) {
                categoryLinksUl.classList.remove("active");
                document.body.classList.remove("category-menu-open");
                closeAllMobileDropdowns(document.querySelectorAll("#categoryLinks li.dropdown"));
            }
        }
    });

    function closeAllMobileDropdowns(dropdownList) {
        dropdownList.forEach(d => {
            d.classList.remove("open");
            const menu = d.querySelector(".dropdown-menu");
            if (menu) menu.style.display = "none";
        });
    }

    function setupDropdowns(navElement) {
        if (!navElement) return;
        const dropdowns = navElement.querySelectorAll("li.dropdown");
        dropdowns.forEach(dropdown => {
            const link = dropdown.querySelector("a:first-child"); 
            const menu = dropdown.querySelector(".dropdown-menu"); 
            if (link && menu) {
                const newLink = link.cloneNode(true);
                if (link.parentNode) link.parentNode.replaceChild(newLink, link);

                if (window.innerWidth > 1024) { 
                     menu.style.display = ''; 
                     dropdown.addEventListener('mouseenter', () => menu.style.display = 'block');
                     dropdown.addEventListener('mouseleave', () => menu.style.display = 'none');
                } else { 
                    menu.style.display = 'none'; 
                    newLink.addEventListener("click", function(event) {
                        if (navElement.classList.contains("active")) { 
                            event.preventDefault(); event.stopPropagation();
                            const isOpen = dropdown.classList.toggle("open");
                            menu.style.display = isOpen ? "block" : "none";
                            dropdowns.forEach(otherDropdown => {
                                if (otherDropdown !== dropdown && otherDropdown.classList.contains("open")) {
                                    otherDropdown.classList.remove("open");
                                    const otherMenu = otherDropdown.querySelector(".dropdown-menu");
                                    if (otherMenu) otherMenu.style.display = "none";
                                }
                            });
                        }
                    });
                }
                menu.addEventListener("click", function(event) { event.stopPropagation(); });
            }
        });
    }
    

    function handleResize() {
        const isDesktop = window.innerWidth > 1024;
        if (isDesktop) {
            if (categoryLinksUl) {
                categoryLinksUl.classList.remove('active');
                document.body.classList.remove("category-menu-open");
            }
            if(desktopSearch) desktopSearch.style.display = 'flex';
        }
        setupDropdowns(categoryLinksUl); 
        createSlider(); 
    }
    window.addEventListener('resize', handleResize);

    const desktopSearchForm = document.getElementById('desktopSearchForm');
    const inlineMobileSearchForm = document.getElementById('inlineMobileSearchForm'); 

    function handleSearch(event) {
        event.preventDefault();
        const searchInput = event.currentTarget.querySelector('input[name="s"]'); 
        const searchTerm = searchInput.value.toLowerCase().trim();

        if (currentCategoryTitleEl) currentCategoryTitleEl.textContent = searchTerm ? `Search Results for: "${searchTerm}"` : 'All Movies';
        document.querySelectorAll('#categoryLinks a[data-category]').forEach(link => link.classList.remove('active-category-link'));
        
        if (!searchTerm) {
            const homeLink = document.querySelector('#categoryLinks a[data-category="All"]');
            if (homeLink) homeLink.classList.add('active-category-link');
            currentFilteredMovies = [...allMoviesData]; 
        } else { 
            currentFilteredMovies = allMoviesData.filter(movie => movie.data.name && movie.data.name.toLowerCase().includes(searchTerm));
        }
        renderMovies(1); 
        
        if (categoryLinksUl && categoryLinksUl.classList.contains("active")) { 
             categoryLinksUl.classList.remove("active");
             document.body.classList.remove("category-menu-open");
        }
    }
    if(desktopSearchForm) desktopSearchForm.addEventListener('submit', handleSearch);
    if(inlineMobileSearchForm) inlineMobileSearchForm.addEventListener('submit', handleSearch); 

    // Initial setup calls
    setCurrentFooterYear();
    loadAllMovies(); 
    handleResize(); 
  </script>
</body>
</html>
